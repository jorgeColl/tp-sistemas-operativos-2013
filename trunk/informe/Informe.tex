%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definición del tipo de documento.                                           %
% Posibles tipos de papel: a4paper, letterpaper, legalpapper                  %
% Posibles tamaños de letra: 10pt, 11pt, 12pt                                 %
% Posibles clases de documentos: article, report, book, slides                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper,10pt]{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Los paquetes permiten ampliar las capacidades de LaTeX.                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Paquete para inclusión de gráficos.
\usepackage{graphicx}
\usepackage{verbatim}

% Paquete notas al pie de página
\usepackage{footnote}

% Paquete que linkea el indice

\usepackage{hyperref}

\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=blue,
    urlcolor=black
}

% Controlar margenes.
\usepackage[left=1.5in,right=1in,top=1.5in,bottom=1.5in]{geometry}

% Agregar indice en el panel lateral.

\usepackage{ifpdf}
%if output to PDF then put the following in PDF header
\ifpdf  
    \pdfcatalog { /PageMode (/UseOutlines)
                  /OpenAction (fitbh)  }
\fi



% Paquete para definir la codificación del conjunto de caracteres usado
% (latin1 es ISO 8859-1).
\usepackage[latin1]{inputenc}

% Paquete para definir el idioma usado.
\usepackage[spanish]{babel}

\usepackage{listingsutf8}
\usepackage{listings}
\lstset{language={}, inputencoding=utf8/latin1, tabsize=4, showstringspaces=false, breaklines=true}


% Título principal del documento.
\title{	{\Huge{	\textbf{Trabajo Práctico: \\
		     Sistma de reserva de entradas sin costo comercial \\ }}}
		    {\hspace{30pt}}}

% Información sobre los autores.
\author{
            \normalsize{Grupo Nº 8 TEMA B} \\
            \normalsize{2do. Cuatrimestre de 2013} \\
            \normalsize{75.08 Sistmas Operativos}                             \\
            \normalsize{Facultad de Ingeniería, Universidad de Buenos Aires}            \\
       }
\date{}

\usepackage{fancyhdr}

\lfoot[GRUPO 8  Tema B]{GRUPO 8  Tema B}
\rfoot[\thepage]{\thepage}
\cfoot[]{}
\renewcommand{\footrulewidth}{0.5pt}

\pagestyle{fancy}


\begin{document}




% Inserta el título.
\maketitle

% Quita el número en la primera página.
\thispagestyle{empty}

% Empieza en una pagina nueva.
\newpage

\tableofcontents

\newpage

\section{Hipótesis y Aclaraciones globales.}
\begin{itemize}
	\item Los directorios NO pueden tener espacios en sus nombres.
	\item Si el archivo 'Instalar\_TP.conf' existe, está bien formado.
	\item Los 2 días para la anticipación de las reservas se cuentan como 48hs desde el momento de la reserva.
	\item Los 30 días para la anticipación de las reservas se cuentan como 720hs desde el momento de la reserva.
	\item Los directorios que configura el usuario son distintos entre sí.
	\item A Mover\_B se le pasan rutas absolutas.
	\item Matar\_D, finaliza todas las instancias del programa solicitado.
	\item Start\_D no inicia el proceso lo el mismo ya se encuentra corriendo en el sistema o el ambiente no se ha inicializado.
	\item Si se desea eliminar un archivo inexistente no se dentendra la ejecución del script. Sólo se informará en el Log.
	\item Los nombres de los archivos de Logs pueden incluir puntos.
	\item El tamaño del Log se verifica luego de escribir, por lo tanto, después de una escritura válidad el Log tiene un tamaño permitido.


\end{itemize}


\newpage



\section {Problemas Relevantes}

\subsection{Instalar}

Uno de los principales problemas que surgió al momento de realizar la instalación 
del sistema, fue que se debía guardar el log de la misma cuando aún no se habían 
definido el directorio asignado para tal fin. Así mismo sucedía que al querer utilizar
el script de Grabar\_L o Mover\_B, estos mismos iban a ser 'movidos' al realizar la
instalación y esto generaba conflictos, ya que se estaba moviendo el mismo archivo 
que se estaba ejecutando. 
Para solucionarlo, se copiaron los archivos binarios que generaban el conflicto en 
vez de moverlos.

\subsection{Está Corriendo}

Para varias funcionalidades, se pide chequear que un script no se ejecute más de una vez.
A la hora de plantear cómo resolver este problema, surgieron varias formas de solucionarlo.
Una forma era que cada script se chequeara a sí mismo, ya fuera mediante una variable de 
ambiente, un archivo auxiliar que guardara dicho estado, etc. El problema de este tipo 
de soluciones es que podían generar la indeseada situación de que dos procesos accedieran
al mismo tiempo a la variable o archivo, si bien era un caso poco probable, era posible así 
que fue descartada.
Finalmente se optó por acudir al comando 'ps' con la opción -e y utilizando expresiones 
regulares, filtrar los resultados y así verificar si el proceso buscado se encontraba o no
en ejecución.

\subsection{Mover\_B}

La caracteristíca básica de este script no presentó muchos inconvenientes. Es decir, mover archivos entre directorios es algo sencillo.
El problema surge cuando en el directorio destino ya se encuentra el archivo que queremos mover. En nuestro caso optamos por mover el 
archivo con un nombre formado por: nombreOriginal+N , en donde N es la cantidad de documentos con el mismo nombre en el directorio.
Adicionalmente, a este script, se le agregó funcionalidad para copiar archivos. Siendo necesaria en su invocación agregar el parámetro
"-c".

\subsection{Grabar\_L}

El motivo de llevar adelante un 'Logger' radica en la trazabilidad de un programa en ejecución. Su implementación resulta ser de 
una dificultad moderada, pero, por el contrario, su utilidad es mucha. 
Para este sistema, se necesitan generar archivos de logs para cada script utilizado. Además 
se le da un trato especial al de instalación, ya que este nunca se recorta y se ubica en un directorio distinto al resto.
Para evitar la duplicación de código, se utiliza el mismo script para todos los archivos de log generados.
Tomando como un caso especial la invocación de 'Grabar\_L.sh' con el 
parámetro '-ins'. En esta oportunidad se genera una ruta distintiva y se anula la funcionalidad de limite de tamaño.


\newpage

\section{Archivo Readme}

\lstinputlisting{../README}


\newpage 


\section{Readme de cada función}

\subsection{Readme\_Instalar}

\lstinputlisting{../Readme_Instalar}

\subsection{Readme\_Iniciar}

\lstinputlisting{../Readme_Iniciar}

\subsection{Readme\_Recibir}

\lstinputlisting{../Readme_Recibir}

\subsection{Readme\_Reservar}

\lstinputlisting{../Readme_Reservar}

\subsection{Readme\_Grabar\_L}

\lstinputlisting{../Readme_Grabar_L}

\subsection{Readme\_Imprimir}

\lstinputlisting{../Readme_Imprimir}

\subsection{Readme\_Stop\_D}

\lstinputlisting{../Readme_Stop_D}


\subsection{Readme\_Start\_D}

\lstinputlisting{../Readme_Start_D}

\subsection{Readme\_Mover\_B}

\lstinputlisting{../Readme_Mover_B}



\section{Esquema de Ejecución}

A continuación se mostrarán los pasos básicos de una ejecución normal, qué archivos se utilizan,
qué función los genera. Se ha utilizado una notación similar a UML para un diagrama de secuencia.

{\newgeometry{left=1.5in,right=0.8in,top=1in,bottom=1in}

\begin{figure}[!htp]
\begin{center}
\includegraphics[width=0.7\textwidth]{DiagramaDeSecuencia.png}
\end{center}
\label{fig001}
\end{figure}

\restoregeometry

\newpage

\section{Listado de nuevas funciones y/o comandos auxiliares}

\subsection{EstaInicializado.sh}

Como su nombre lo indica, permite detectar si el ambiente en el que se encuentra corriendo
el script ha sido inicializado o no. Ya que en varias partes del sistema se realiza este
chequeo, se ha encapsulado aquí para evitar la repetición de código.

\subsection{EstaCorriendo.sh}

Esta funcionalidad permite verificar si un proceso se encuentra en ejecución o no. Surge
de la necesidad de comprobar que un scritp como Recibir o Reservar, no se ejecuten más de 
una vez ya que podrían generarse inconsistencias en el sistema.

\subsection{Mover\_B.sh opción -c}

Si bien en las especificaciones se incluye el comando 'Mover\_B' se le ha agregado la opción
para que permita copiar ciertos archivos en vez de moverlos.
De este modo, con unas pequeñas modificaciones, se utiliza el mismo comando para la etapa de
instalación del sistema.


\newpage

\section{Listado de Nuevos Archivos}
\subsection{LOGDIR/count}

Este archivo es creado por Recibir\_B. Tiene como propósito llevar la cuenta de la cantidad de
veces que se ha ejecutado el ciclo 'Recibir'. Consta de un único campo, de la forma n=Nº de Ciclo.

\subsection{CONFDIR/backup}
\label{subsec:backup}
Esta carpeta se crea en el momento de la instalación. En ella se copiarán todos los archivos binarios que 
precisa el sistema para funcionar hasta que el usuario decida dónde va a ubicarlos.
La carpeta se mantiene como resguardo para preservar el funcionamiento del sistema.
Si por algún motivo se pierde algún archivo binario del directorio 'BINDIR', el script
\texttt{Iniciar\_B} lo detectará y utilizará esta copia de resguardo para reponerlo.

\newpage
\section{Listado de Datos}

Para realizar la 'Prueba del camino Feliz' (ver sección ~\ref{sec:camino_feliz}) no sólo se 
han utilizado los datos provistos por la cátedra, sino que también se han agregado ciertos casos
no contemplados por los mismos. Como por ejemplo reservas fuera de fecha, nombres de archivos
inválidos, etc.

Para esta parte de las pruebas, los archivos \texttt{combos.dis, obras.mae} 
y \texttt{salas.mae} no han sido modificados.

A continuación, listamos los escenarios testeados y sus archivos asociados.



\begin{table} [h]
\centering
\begin{tabular}{ |p{6cm}|p{1,5cm}|p{4cm}| } 
\hline\hline
 Archivo                                    	& Provisto 	& Caso testeado \\ [0.5ex]
 \hline
 1-LEYER\_DEMIAN@GMAIL.COM-EstrenoenelPayro334 & SI 		& Reserva por obra disponible.\\
 \hline
1-LEYER\_DEMIAN@GMAIL.COM-EstrenoenelPayro332 	& SI 		& Reserva con menos de 48hs. \\
\hline
1-LEYER\_DEMIAN@GMAIL.COM-EstrenoenelPayro333	& SI 		& Obra no disponible. \\
\hline
1-MAIL\_INVALIDO@GMAIL.COM-EstrenoenelPayro332
 & NO		& Mail inválido. \\
\hline
147-LEYER\_DEMIAN@GMAIL.COM-EstrenoenelPayro332 & NO		& ID obra inválido. \\
\hline
133-GRIFFO\_JULIO@GMAIL.COM-muchaAnticipacion 	 & NO 		& Reserva excede los 30 días. \\
\hline
NOMBRE\_INVALIDO				& NO		& Formato de nombre incorrecto. \\
\hline
133-GRIFFO\_JULIO@GMAIL.COM-vacio		& NO 		& Archivo vacío. \\
\hline
6-Teatro.Corrientes.Azul@reservas. com.ar-TCA\_3Nov13 & SI 	& Reserva por sala. No disponible. \\
\hline
18-Teatro.Payro@reservas.com.ar-PAyro251013a & SI 		& Reserva por sala. Disponible. \\
\hline
18-MAIL\_INVALIDO@GMAIL.COM-PAyro251013a	& NO 		& Mail inválido. \\
\hline
180-Teatro.Payro@reservas.com.ar-ID\_INVALIDO  & NO 		& ID sala inválido. \\

 \hline

 
 
 
\end{tabular}

\end{table}

\newpage
\section{Prueba del Camino Feliz}
\label{sec:camino_feliz}

{\newgeometry{left=1.5in,right=0.8in,top=1in,bottom=1in}
Para realizar la prueba de una ejecución normal, desde que se instala el sistema, hasta llegar 
al comando imprimir, se cuenta con un script que va realizando cada paso. La salida de cada comando,
así como los archivos generados, se vuelcan en un archivo denominado 'caminoFeliz.out'


\lstinputlisting{../caminoFeliz.out}

\restoregeometry

\end{document}
